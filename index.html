<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏汇率计算器</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        [v-cloak] { display: none; }
        
        /* 紧凑风格微调 */
        .compact-input {
            @apply py-2 px-3 text-sm;
        }
    </style>
</head>
<body class="bg-gray-100 text-slate-900 font-sans antialiased">
    <div id="app" v-cloak class="min-h-screen p-4 md:p-8">
        <div class="max-w-4xl mx-auto space-y-4">
            
            <!-- 头部 -->
            <header class="flex items-center justify-between bg-white p-4 border border-gray-200 rounded-md shadow-sm">
                <div class="flex items-center gap-3">
                    <div class="p-1.5 bg-slate-800 rounded">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-tight">{{ lang === 'zh-TW' ? '資產匯率計算器' : '资产汇率计算器' }}</h1>
                        <p class="text-gray-500 text-xs">{{ lang === 'zh-TW' ? '快速進行遊戲幣與實物價值轉換' : '快速进行游戏币与实物价值转换' }}</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <div class="hidden md:flex items-center gap-2 px-3 py-1 bg-green-50 border border-green-100 rounded text-[11px] font-bold text-green-700">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                        {{ lang === 'zh-TW' ? '即時計算已就緒' : '实时计算已就绪' }}
                    </div>
                    <div class="flex items-center gap-1 bg-gray-100 p-0.5 rounded border border-gray-200">
                        <button @click="setLang('zh-TW')" :class="lang === 'zh-TW' ? 'bg-white shadow-sm text-slate-900' : 'text-gray-500'" class="px-2 py-0.5 text-[11px] font-bold rounded transition-all whitespace-nowrap">繁體</button>
                        <button @click="setLang('zh-CN')" :class="lang === 'zh-CN' ? 'bg-white shadow-sm text-slate-900' : 'text-gray-500'" class="px-2 py-0.5 text-[11px] font-bold rounded transition-all whitespace-nowrap">简体</button>
                    </div>
                </div>
            </header>

            <!-- 汇率设置行 (2列) -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- 基础汇率 -->
                <section class="bg-white p-4 border border-gray-200 rounded-md shadow-sm">
                    <div class="flex items-center gap-2 mb-3">
                        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <h2 class="text-sm font-bold text-gray-700">{{ lang === 'zh-TW' ? '基礎匯率' : '基础汇率' }} ({{ currency }})</h2>
                    </div>
                    <div class="flex items-center gap-2 bg-gray-50 border border-gray-200 rounded p-1">
                        <span class="px-3 text-xs font-bold text-gray-500 whitespace-nowrap">1 {{ baseCurrencyUnitLabel }} =</span>
                        <input type="number" v-model.number="ratioMoneyToCoin" class="w-full bg-transparent border-none focus:ring-0 text-right font-mono font-bold text-slate-700 text-sm py-1.5" placeholder="游戏币数">
                        <span class="pr-3 text-xs text-gray-400 whitespace-nowrap flex-shrink-0">游戏币</span>
                    </div>
                </section>

                <!-- 代币汇率 -->
                <section class="bg-white p-4 border border-gray-200 rounded-md shadow-sm">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2 text-gray-700">
                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            <h2 class="text-sm font-bold">雪花价值设置</h2>
                        </div>
                        <div class="flex bg-gray-100 p-0.5 rounded border border-gray-200">
                            <button @click="snowflakeMode = 'cny'" :class="snowflakeMode === 'cny' ? 'bg-white shadow-sm text-slate-900' : 'text-gray-500'" class="px-2 py-0.5 text-[10px] font-bold rounded transition-all whitespace-nowrap">{{ lang === 'zh-TW' ? '台幣' : '人民币' }}</button>
                            <button @click="snowflakeMode = 'coin'" :class="snowflakeMode === 'coin' ? 'bg-white shadow-sm text-slate-900' : 'text-gray-500'" class="px-2 py-0.5 text-[10px] font-bold rounded transition-all whitespace-nowrap">游戏币</button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 bg-gray-50 border border-gray-200 rounded p-1">
                        <span class="px-3 text-xs font-bold text-gray-500 whitespace-nowrap">1 雪花 =</span>
                        <input type="number" v-model.number="ratioSnowflakeValue" class="w-full bg-transparent border-none focus:ring-0 text-right font-mono font-bold text-slate-700 text-sm py-1.5" placeholder="比例">
                        <span class="pr-3 text-xs text-gray-400 whitespace-nowrap flex-shrink-0">{{ snowflakeMode === 'cny' ? '元' : '游戏币' }}</span>
                    </div>
                </section>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                <!-- 输入面板 -->
                <div class="md:col-span-5 space-y-4">
                    <section class="bg-white p-5 border border-gray-200 rounded-md shadow-sm">
                        <div class="flex items-center gap-2 mb-4">
                            <h2 class="text-sm font-bold text-gray-700 uppercase tracking-tight italic border-l-4 border-slate-800 pl-2">道具价格输入</h2>
                        </div>
                        <div class="flex items-stretch gap-2">
                            <div class="relative flex-1">
                                <div class="absolute inset-y-0 left-3 flex items-center pointer-events-none text-gray-300">
                                    <span class="text-sm font-bold italic">$</span>
                                </div>
                                <input type="number" v-model="inputPrice" class="w-full pl-8 pr-3 py-3 bg-gray-50 border border-gray-200 rounded focus:ring-2 focus:ring-slate-800 focus:border-slate-800 outline-none text-xl font-bold transition-all" placeholder="输入金额">
                            </div>
                            <select v-model="inputUnit" class="w-20 bg-gray-50 border border-gray-200 rounded px-2 text-sm font-bold text-gray-600 outline-none cursor-pointer">
                                <option v-for="u in units" :key="u.label" :value="u.value">{{ u.label }}</option>
                            </select>
                        </div>
                        <div class="mt-3 text-[11px] text-gray-400 flex items-center gap-1.5 px-1">
                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            提示：结果将自动根据 5% 交易税费进行计算
                        </div>
                    </section>

                    <!-- 详情卡片 -->
                    <section class="bg-slate-800 text-slate-100 p-5 rounded-md shadow-lg">
                        <h3 class="text-xs font-bold text-slate-400 mb-4 uppercase tracking-widest">交易明细</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-slate-400">原始金额:</span>
                                <span class="font-mono">{{ formatLargeNumber(results.totalCoins) }}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-rose-400">手续费(5%):</span>
                                <span class="font-mono text-rose-300">-{{ formatLargeNumber(results.fee) }}</span>
                            </div>
                            <div class="h-px bg-slate-700 my-2"></div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs font-bold text-slate-400">到手净额:</span>
                                <div class="text-right">
                                    <div class="text-xl font-black text-white font-mono leading-none">{{ formatLargeNumber(results.actualReceived) }}</div>
                                    <div class="text-[14px] text-gray-300 mt-1 uppercase whitespace-nowrap flex-shrink-0">{{ formatCnText(results.actualReceived) }}</div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- 结果分析 -->
                <div class="md:col-span-7">
                    <div class="bg-white border border-gray-200 rounded-md shadow-sm h-full flex flex-col overflow-hidden">
                        <div class="px-6 py-3 border-b border-gray-100 bg-gray-50 flex items-center justify-between">
                            <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest">转换评估分析</h2>
                            <div class="w-2 h-2 rounded-full bg-slate-300"></div>
                        </div>

                        <div class="p-6 flex-1 flex flex-col justify-center space-y-6">
                            
                            <!-- 主卡片：人民币 -->
                            <div class="bg-white border border-gray-200 p-6 rounded relative overflow-hidden group hover:border-slate-800 transition-colors">
                                <div class="text-[10px] font-black text-slate-400 uppercase mb-2 tracking-tighter">{{ lang === 'zh-TW' ? '評估價值 (台幣)' : '评估价值 (人民币)' }}</div>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-sm font-bold text-slate-800 italic">{{ currency }}</span>
                                    <span class="text-4xl font-black text-slate-900 tabular-nums">{{ formatNumber(results.valueInMoney) }}</span>
                                </div>
                                <div class="mt-4 flex items-center gap-4 text-[10px] font-bold">
                                    <span class="text-slate-400">{{ lang === 'zh-TW' ? '基於比例' : '基于比例' }} 1:{{ ratioMoneyToCoin }}</span>
                                    <span class="text-emerald-600 bg-emerald-50 px-2 rounded">已同步</span>
                                </div>
                                <div class="absolute right-[-10px] top-[-10px] opacity-[0.03] group-hover:opacity-[0.05] transition-opacity">
                                    <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1.41 16.09V20h-2.67v-1.93c-1.71-.36-3.16-1.46-3.27-3.4h1.96c.1 1.05.82 1.87 2.65 1.87 1.96 0 2.4-.98 2.4-1.59 0-.83-.44-1.61-2.67-2.14-2.48-.6-4.18-1.62-4.18-3.97 0-1.8 1.39-3.06 3.11-3.4V3.33h2.67V5.4c1.39.28 2.48 1.1 2.74 2.23h-1.97c-.23-.63-.7-.96-1.88-.96-1.16 0-2.13.52-2.13 1.55 0 .89.65 1.42 2.67 1.93 2.53.62 4.18 1.71 4.18 4.23 0 1.93-1.37 3.23-3.15 3.61z"/></svg>
                                </div>
                            </div>

                            <!-- 主卡片：雪花 -->
                            <div class="bg-white border border-gray-200 p-6 rounded relative overflow-hidden group hover:border-slate-800 transition-colors">
                                <div class="text-[10px] font-black text-slate-400 uppercase mb-2 tracking-tighter">评估价值 (雪花)</div>
                                <div class="flex items-baseline gap-2">
                                    <span class="text-4xl font-black text-slate-900 tabular-nums">{{ formatNumber(results.valueInSnowflakes) }} <span class="text-xs">个</span></span>
                                </div>
                                <div class="mt-4 flex items-center gap-4 text-[10px] font-bold">
                                    <span class="text-slate-400">
                                        汇率模式: 
                                        {{ snowflakeMode === 'cny' ? `1 雪花 = ${ratioSnowflakeValue} ${baseCurrencyUnitLabel}` : `1 雪花 = ${ratioSnowflakeValue} 游戏币` }}
                                    </span>
                                </div>
                                <div class="absolute right-[-10px] top-[-10px] opacity-[0.03] group-hover:opacity-[0.05] transition-opacity rotate-45">
                                    <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2h6zm-4 4l-4 4-1.41-1.41L5.59 14 1.59 10 3 8.59 7 12.59l4-4 1.41 1.41L8.41 14l4 4-1.41 1.41L7 15z"/></svg>
                                </div>
                            </div>

                        </div>

                        <div class="bg-gray-50 px-6 py-2 border-t border-gray-100 flex justify-between">
                            <span class="text-[9px] font-black text-gray-400 uppercase tracking-widest">汇率计算器 v2.0</span>
                            <span class="text-[9px] font-mono text-gray-400">Beat Up 公会成员开发</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, watchEffect, computed } = Vue;

        createApp({
            setup() {
                // 语言与货币
                const lang = ref('zh-TW'); // 默认繁體
                const currency = ref('TWD'); // 繁體綁定台幣
                const setLang = (l) => {
                    lang.value = l;
                    currency.value = l === 'zh-TW' ? 'TWD' : 'CNY';
                };
                const baseCurrencyUnitLabel = computed(() => (currency.value === 'TWD' ? '台幣' : '人民币'));

                // 基础参数
                const ratioMoneyToCoin = ref(800000); 
                const snowflakeMode = ref('cny'); // 'cny' 或 'coin'
                const ratioSnowflakeValue = ref(0.41);
                
                const inputPrice = ref('');
                const inputUnit = ref(1);

                const units = [
                    { label: '币', value: 1 },
                    { label: '万', value: 10000 },
                    { label: '亿', value: 100000000 },
                ];

                const results = ref({
                    totalCoins: 0,
                    fee: 0,
                    actualReceived: 0,
                    valueInCny: 0,
                    valueInSnowflakes: 0,
                });

                watchEffect(() => {
                    const price = parseFloat(inputPrice.value) || 0;
                    const totalCoins = price * inputUnit.value;
                    
                    const fee = totalCoins * 0.05;
                    const actualReceived = totalCoins - fee;

                    // 计算貨幣價值（依選擇台幣/人民幣）
                    const valueInMoney = ratioMoneyToCoin.value > 0 ? totalCoins / ratioMoneyToCoin.value : 0;
                    
                    // 计算雪花价值
                    let valueInSnowflakes = 0;
                    if (ratioSnowflakeValue.value > 0) {
                        if (snowflakeMode.value === 'cny') {
                            // 雪花對應台幣或人民幣（依當前語言綁定）
                            valueInSnowflakes = valueInMoney / ratioSnowflakeValue.value;
                        } else {
                            // 雪花对应游戏币
                            valueInSnowflakes = totalCoins / ratioSnowflakeValue.value;
                        }
                    }

                    results.value = {
                        totalCoins,
                        fee,
                        actualReceived,
                        valueInMoney,
                        valueInSnowflakes
                    };
                });

                const formatNumber = (num) => {
                    if (!num) return '0.00';
                    return Number(num.toFixed(4)).toLocaleString();
                };

                const formatLargeNumber = (num) => {
                    return Math.floor(num).toLocaleString();
                };

                const formatCnText = (num) => {
                    const n = Math.floor(Number(num) || 0);
                    if (n >= 100000000) {
                        const yi = Math.floor(n / 100000000);
                        const wan = Math.floor((n % 100000000) / 10000);
                        return wan > 0 ? `${yi} 亿 ${wan} 万` : `${yi} 亿`;
                    }
                    if (n >= 10000) {
                        const wan = (n / 10000).toFixed(2).replace(/\.?0+$/, '');
                        return `${wan} 万`;
                    }
                    return n.toLocaleString();
                };

                return {
                    lang,
                    currency,
                    setLang,
                    baseCurrencyUnitLabel,
                    ratioMoneyToCoin,
                    snowflakeMode,
                    ratioSnowflakeValue,
                    inputPrice,
                    inputUnit,
                    units,
                    results,
                    formatNumber,
                    formatLargeNumber,
                    formatCnText
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
